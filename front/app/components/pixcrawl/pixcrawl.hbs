<div class="pixcrawl">
    {{!-- steps topbar --}}
    <div class="steps">
        <button type="button" class="step step-current" {{on "mouseenter" (fn this.highlightDiamond 0)}}
            {{on "mouseleave" this.dimDiamond}} {{on "click" (fn this.showStep 1)}}>
            <div class="title-up">Keyword</div>
            <div class="diamond diamond-current" />
        </button>
        <div class="join" />
        <button type="button" class="step" {{on "mouseenter" (fn this.highlightDiamond 1)}} {{on "mouseleave"
            this.dimDiamond}} {{on "click" (fn this.showStep 2)}}>
            <div class="diamond" />
            <div class="title-down">Search</div>
        </button>
        <div class="join" />
        <button type="button" class="step" {{on "mouseenter" (fn this.highlightDiamond 2)}} {{on "mouseleave"
            this.dimDiamond}} {{on "click" (fn this.showStep 3)}}>
            <div class="title-up">Crawl</div>
            <div class="diamond" />
        </button>
        <div class="join" />
        <button type="button" class="step" {{on "mouseenter" (fn this.highlightDiamond 3)}} {{on "mouseleave"
            this.dimDiamond}}>
            <div class="diamond" />
            <div class="title-down">Download</div>
        </button>
    </div>

    {{!-- keyword step --}}
    <div class="keyword">
        <div class="main">
            <h2>Keywords - </h2>
            {{#each this.keywords as |kwd|}}
            <div class="tag-item" {{on "animationend" (fn this.cancelTagHighlight kwd.index)}}>
                <button class="tag-name" type="button" {{on "click" (fn this.showDropdown
                    kwd.index)}}>{{kwd.type}}</button>
                <div class="tag-dropdown" {{on 'mouseleave' (fn this.hideDragdown kwd.index)}}>
                    {{#each kwd.dropdown as |dropdownItem|}}
                    <button class="dropdown-item" type="button" {{on "click" (fn this.changeTag dropdownItem.tag
                        kwd.index)}}>
                        <span class="tag-icon">{{dropdownItem.tag}}</span>
                        <span class="tag-desc">{{dropdownItem.desc}}</span>
                    </button>
                    {{/each}}
                </div>
                <input aria-label="input tag content" spellcheck="false" {{on "input" (fn this.changeInputWidth
                    kwd.index)}} {{did-insert (fn this.fillTagContent kwd.index)}}>
                <button type="button" class="close-tag" {{on "click" (fn this.removeTag kwd.index)}}>
                    <Icons::CrossX />
                </button>
            </div>
            {{/each}}
            <div class="add-tags">
                <span>Add new searching options by clicking </span>
                <button type="button" {{on "mouseenter" this.showTagsIcon}} {{on "mouseleave" this.hideTagsIcon}}
                    {{on "click" this.addTags}}>
                    <Icons::Tag />
                    <Icons::Tags />
                </button>
            </div>
        </div>
        <div class="bottom-nav">
            <button type="button" {{on "click" this.goToSearch}}>
                <span>Search</span>
                <Icons::AnglesRight />
            </button>
        </div>
    </div>

    {{!-- search step --}}
    <div class="search">
        <div class="progress">
            <h2>Total Progress</h2>
            <div class="search-target">
                Starting...
            </div>
            <div class="bar-content">
                <div class="bar-bg" />
                <div class="bar" />
                <div class="percent">0%</div>
            </div>
            <div class="abstract">
                {{!-- xxx tags, xxx user names, xxx picture ids... --}}
                {{!-- <span>10</span> tags. --}}
            </div>
            <div class="abstract-progress">
                <span class="completed">0</span> completed. <span class="failed">0</span> failed.
            </div>
        </div>
        <ul class="contents">
            {{#each this.keywords as |kwd idx|}}
            {{#let (get this.searchResults idx) as |result|}}
            {{#if result.elementState.display}}
            <li>
                <div class="search-keyword">
                    <div class="value">{{kwd.value}}</div>
                    <div class="type">{{kwd.type}}</div>
                </div>
                {{#if result.elementState.searching}}
                <Icons::Hourglass />
                {{else}}
                <button type="button" {{on "click" (fn this.toggleDetailedSearchResult idx)}}>
                    {{#if result.elementState.expand}}
                    <Icons::TriangleRight class="triangle-down" />
                    {{else}}
                    <Icons::TriangleRight />
                    {{/if}}
                </button>
                {{/if}}
                <div class="search-result">
                    {{#if (eq kwd.type "uid")}}
                    <div class="result-abstract">
                        <img alt="avatar" src={{result.avatar}} />
                        <div class="value">{{result.uname}}</div>
                        <div class="type">uname</div>
                        <button class="delete" type="button" {{on "click" (fn this.deleteSearchOption idx)}}>
                            <Icons::CrossX />
                        </button>
                    </div>
                    {{#if result.elementState.expand}}
                    <div class="result-extended">
                        <div class="previews">
                            <h3>Previews</h3>
                            <div class="preview-imgs">
                                {{#each result.pictures as |picture|}}
                                <img alt={{picture.title}} title={{picture.title}} src={{picture.content}} />
                                {{/each}}
                            </div>
                        </div>
                        <div class="tags">
                            <h3>Featured Tags</h3>
                            <div class="tag-contents">
                                {{#each result.tags as |tag|}}
                                {{#if (inSearchTags this.searchResults tag)}}
                                <span class="tag-included">#{{tag}}<span>✓</span></span>
                                {{else}}
                                <button class="tag-new" type="button" {{on "click" (fn this.addNewTagInSearch
                                    tag)}}>#{{tag}}<span>+</span>
                                </button>
                                {{/if}}
                                {{/each}}
                            </div>
                        </div>
                    </div>
                    {{/if}} {{!-- End of if result.expand --}}
                    {{else if (eq kwd.type "uname")}}
                    {{!-- Exceptionally, the results will be searched once. No extra extended searches. --}}
                    {{#if (not (get result "extended"))}}
                    {{#let (get result.value 0) as |head|}}
                    <div class="result-abstract">
                        <img alt="avatar" src={{head.avatar}} />
                        <div class="value">{{head.uname}}</div>
                        <div class="type">uname
                            <span>{{if (inSearchUids this.keywords this.searchResults head.uid idx) "✓"}}</span>
                        </div>
                        <div class="value-uid">{{head.uid}}</div>
                        <button class="delete" type="button" {{on "click" (fn this.deleteSearchOption idx)}}>
                            <Icons::CrossX />
                        </button>
                        {{!-- add or tick button... --}}
                        {{#if (moreThanOne result.value.length)}}
                        <button class="more" type="button" {{on "click" (fn this.toggleDetailedUserInfo idx 0)}}>
                            <Icons::AnglesRight />
                        </button>
                        {{/if}}
                    </div>
                    {{#if result.elementState.expand}}
                    <div class="result-extended">
                        {{!-- template: ref on result-abstract --}}
                        {{#each result.value as |tail tailIndex|}}
                        {{#if (neq tailIndex 0)}}
                        <div class="candidate">
                            <div class="result-itembg"></div>
                            <img alt="avatar" src={{tail.avatar}} />
                            <button type="button" class="value" {{on "click" (fn this.selectCandidate idx tailIndex)}}>{{tail.uname}}</button>
                            <div class="type">uname</div>
                            <div class="value-uid">{{tail.uid}}</div>
                        </div>
                        {{/if}}
                        {{/each}}
                    </div>
                    {{/if}} {{!-- End of if result.expand --}}
                    {{/let}}
                    {{else}}
                    {{#let (get result.value result.extendIndex) as |extendedResult|}}
                    <div class="result-abstract">
                        <img alt="avatar" src={{extendedResult.avatar}} />
                        <div class="value">{{extendedResult.uname}}</div>
                        <div class="type">uname</div>
                        <div class="value-uid">{{extendedResult.uid}}</div>
                        <button class="delete" type="button" {{on "click" (fn this.deleteSearchOption idx)}}>
                            <Icons::CrossX />
                        </button>
                        <button class="back" type="button" {{on "click" (fn this.toggleDetailedUserInfo idx
                            result.extendIndex)}}>
                            <Icons::AnglesLeft />
                        </button>
                    </div>
                    {{#if result.elementState.expand}}
                    <div class="result-extended">
                        <div class="previews">
                            <h3>Previews</h3>
                            <div class="preview-imgs">
                                {{#each extendedResult.pictures as |picture|}}
                                <img alt={{picture.title}} title={{picture.title}} src={{picture.content}} />
                                {{/each}}
                            </div>
                        </div>
                        <div class="tags">
                            <h3>Featured Tags</h3>
                            <div class="tag-contents">
                                {{#each extendedResult.tags as |tag|}}
                                {{#if (inSearchTags tag)}}
                                <span class="tag-included">#{{tag}}<span>√</span></span>
                                {{else}}
                                <button class="tag-new" type="button" {{on "click" (fn this.addNewTagInSearch
                                    tag)}}>#{{tag}}<span>+</span>
                                </button>
                                {{/if}}
                                {{/each}}
                            </div>
                        </div>
                    </div>
                    {{/if}} {{!-- End of if result.expand --}}
                    {{/let}}
                    {{/if}} {{!-- End of result.extended == false --}}
                    {{/if}} {{!-- End of kwd.type == ... --}}
                </div>
            </li>
            {{/if}} {{!-- End of if result.display --}}
            {{/let}} {{!-- End of let result = searchResults[i] --}}
            {{/each}}
        </ul>
    </div>
    <div class="crawl">

    </div>
    <div class="download">

    </div>
    <div class="hint">
        <div class="topbar"></div>
        <div class="content" {{on "animationend" this.hideHint}}>
            Hello World!
            {{!-- insert hints by JS --}}
        </div>
    </div>
</div>